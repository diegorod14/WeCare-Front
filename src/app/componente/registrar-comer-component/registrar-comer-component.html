<div class="registrar-comer-container">

  <div *ngIf="cargando && !alimento" class="loading-container">
    <mat-icon class="spinner">refresh</mat-icon>
    <p>Cargando...</p>
  </div>

  <mat-card class="main-card" *ngIf="alimento">
    <div class="layout-grid">

      <div class="panel-info">
        <div class="header-section">
          <span class="categoria-badge">{{ alimento.categoriaNombre }}</span>
          <h2>{{ alimento.nombre }}</h2>
          <p class="subtitle">Información nutricional por 100g</p>
        </div>

        <div class="nutrition-table">
          <div class="nutri-row">
            <span class="nutri-label"><mat-icon>local_fire_department</mat-icon> Calorías</span>
            <span class="nutri-value">{{ alimento.calorias | number:'1.0-0' }}</span>
          </div>
          <div class="nutri-row">
            <span class="nutri-label"><mat-icon>fitness_center</mat-icon> Proteína</span>
            <span class="nutri-value">{{ alimento.proteina | number:'1.1-1' }}g</span>
          </div>
          <div class="nutri-row">
            <span class="nutri-label"><mat-icon>grain</mat-icon> Carbos</span>
            <span class="nutri-value">{{ alimento.carbohidrato | number:'1.1-1' }}g</span>
          </div>
          <div class="nutri-row">
            <span class="nutri-label"><mat-icon>water_drop</mat-icon> Grasas</span>
            <span class="nutri-value">{{ alimento.grasa | number:'1.1-1' }}g</span>
          </div>
        </div>

        <div class="food-icon-bg">
          <mat-icon>restaurant_menu</mat-icon>
        </div>
      </div>

      <div class="panel-action">
        <div class="action-header">
          <h3>Registrar Consumo</h3>
        </div>

        <form class="compact-form">
          <div class="hero-input-group">
            <mat-form-field appearance="outline" class="big-input">
              <mat-label>Cantidad</mat-label>
              <input matInput type="number" [(ngModel)]="consumoRequest.cantidad" name="cantidad" min="0" required (ngModelChange)="calcularCaloriasEstimadas()">
            </mat-form-field>

            <mat-form-field appearance="outline" class="unit-input">
              <mat-label>Unidad</mat-label>
              <mat-select [(ngModel)]="consumoRequest.unidad" name="unidad" (ngModelChange)="calcularCaloriasEstimadas()">
                <mat-option value="g">g</mat-option>
                <mat-option value="kg">kg</mat-option>
                <mat-option value="ml">ml</mat-option>
                <mat-option value="porcion">Porción</mat-option>
              </mat-select>
            </mat-form-field>
          </div>

          <div class="live-results">
            <div class="result-pill primary">
              <span class="lbl">Total Estimado</span>
              <span class="val">{{ calcularCaloriasEstimadas() | number:'1.0-0' }} <small>kcal</small></span>
            </div>
            <div class="macros-mini">
              <span class="macro p">Proteinas: {{ calcularProteinaEstimada() | number:'1.0-0' }}g</span>
              <span class="macro c">Carbohidratos: {{ calcularCarbohidratoEstimado() | number:'1.0-0' }}g</span>
              <span class="macro f">Grasas: {{ calcularGrasaEstimada() | number:'1.0-0' }}g</span>
            </div>
          </div>

          <div class="secondary-inputs">
            <div class="date-time-row">
              <mat-form-field appearance="outline" density="compact">
                <mat-label>Fecha</mat-label>
                <input matInput type="date" [(ngModel)]="consumoRequest.fechaConsumo" name="fecha">
              </mat-form-field>
              <mat-form-field appearance="outline" density="compact">
                <mat-label>Hora</mat-label>
                <input matInput type="time" [(ngModel)]="consumoRequest.horaConsumo" name="hora">
              </mat-form-field>
            </div>

            <mat-form-field appearance="outline" density="compact" class="w-100">
              <mat-label>Notas (Opcional)</mat-label>
              <input matInput [(ngModel)]="consumoRequest.nota" name="nota" placeholder="Ej: Desayuno...">
            </mat-form-field>
          </div>

          <div class="action-buttons">
            <button mat-button (click)="cancelar()" [disabled]="cargando">Cancelar</button>
            <button mat-raised-button color="primary" (click)="registrarConsumo()" [disabled]="cargando" class="btn-save">
              {{ cargando ? 'Guardando...' : 'Confirmar' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </mat-card>
</div>
